# Лабораторная работа №19: DLL-библиотеки

## Теория

### DLL-библиотеки (Dynamic Link Library)

DLL-библиотеки - это файлы, содержащие код и данные, которые могут использоваться несколькими программами одновременно. В .NET они представлены сборками (assemblies) с расширением .dll.

#### Основные концепции

1. **Сборка (Assembly)** - единица развертывания в .NET
2. **Библиотека классов** - проект, компилируемый в DLL
3. **Ссылки на проекты** - способ подключения библиотек
4. **Пространства имен** - организация кода в библиотеках

#### Типы проектов

```csharp
// Библиотека классов (.csproj)
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <OutputType>Library</OutputType>
  </PropertyGroup>
</Project>

// Консольное приложение (.csproj)
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <OutputType>Exe</OutputType>
  </PropertyGroup>
</Project>
```

#### Создание библиотеки классов

```csharp
namespace MyLibrary
{
    public class Calculator
    {
        public int Add(int a, int b) => a + b;
        public int Subtract(int a, int b) => a - b;
        public int Multiply(int a, int b) => a * b;
        public double Divide(int a, int b) => (double)a / b;
    }
}
```

#### Подключение библиотеки

```csharp
// Ссылка на проект
<ItemGroup>
  <ProjectReference Include="..\MyLibrary\MyLibrary.csproj" />
</ItemGroup>

// Использование в коде
using MyLibrary;

var calc = new Calculator();
int result = calc.Add(5, 3);
```

### Структура решения

#### Многоуровневая архитектура
```
Solution/
├── Library1/          # Библиотека данных
│   ├── Models/
│   └── Collections/
├── Library2/          # Библиотека сервисов
│   └── Services/
└── ConsoleApp/        # Консольное приложение
    └── Program.cs
```

#### Зависимости между проектами
```csharp
// ConsoleApp зависит от Library1 и Library2
// Library2 зависит от Library1
// Library1 не зависит ни от кого
```

### Системные библиотеки .NET

#### System.Environment
```csharp
// Информация о системе
Console.WriteLine($"ОС: {Environment.OSVersion}");
Console.WriteLine($"Процессоров: {Environment.ProcessorCount}");
Console.WriteLine($"Пользователь: {Environment.UserName}");

// Переменные окружения
string path = Environment.GetEnvironmentVariable("PATH");
string temp = Environment.GetEnvironmentVariable("TEMP");

// Специальные папки
string desktop = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);
string documents = Environment.GetFolderPath(Environment.SpecialFolder.MyDocuments);
```

#### System.Diagnostics
```csharp
// Информация о процессах
var processes = Process.GetProcesses();
foreach (var process in processes.Take(5))
{
    Console.WriteLine($"{process.ProcessName}: {process.Id}");
}

// Запуск процесса
Process.Start("notepad.exe");
```

#### System.IO
```csharp
// Работа с файлами
var files = Directory.GetFiles(@"C:\", "*.txt");
foreach (var file in files)
{
    var fileInfo = new FileInfo(file);
    Console.WriteLine($"{fileInfo.Name}: {fileInfo.Length} байт");
}

// Работа с директориями
var directories = Directory.GetDirectories(@"C:\");
foreach (var dir in directories.Take(5))
{
    Console.WriteLine(dir);
}
```

### Лучшие практики

#### 1. Организация кода
```csharp
// Разделение на логические слои
namespace ProductLibrary
{
    public class Product { }        // Модель данных
    public class ProductCatalog { } // Коллекция
}

namespace ProductService
{
    public class ProductService { } // Бизнес-логика
}
```

#### 2. Ссылки на проекты
```xml
<!-- Правильное подключение -->
<ItemGroup>
  <ProjectReference Include="..\ProductLibrary\ProductLibrary.csproj" />
</ItemGroup>
```

#### 3. Версионирование
```xml
<PropertyGroup>
  <Version>1.0.0</Version>
  <AssemblyVersion>1.0.0.0</AssemblyVersion>
  <FileVersion>1.0.0.0</FileVersion>
</PropertyGroup>
```

#### 4. Документация
```csharp
/// <summary>
/// Сервис для работы с продуктами
/// </summary>
public class ProductService
{
    /// <summary>
    /// Поиск продуктов по категории
    /// </summary>
    /// <param name="category">Категория для поиска</param>
    /// <returns>Список продуктов</returns>
    public List<Product> SearchByCategory(string category)
    {
        // Реализация
    }
}
```

### Преимущества DLL-библиотек

1. **Переиспользование кода** - одна библиотека для многих приложений
2. **Модульность** - разделение на логические компоненты
3. **Тестируемость** - изолированное тестирование компонентов
4. **Обновления** - независимое обновление компонентов
5. **Разработка командой** - параллельная разработка модулей

### Недостатки

1. **Сложность управления зависимостями** - нужно следить за версиями
2. **Проблемы совместимости** - изменения в библиотеке могут сломать приложения
3. **Усложнение развертывания** - нужно развертывать все зависимости
4. **Отладка** - сложнее отлаживать код в библиотеках

### Типичные сценарии использования

#### Библиотека данных
```csharp
public class Product
{
    public int Id { get; set; }
    public string Name { get; set; }
    public decimal Price { get; set; }
}

public class ProductCatalog
{
    private List<Product> products = new();
    
    public void AddProduct(Product product) { }
    public List<Product> GetAllProducts() { }
    public Product? GetProduct(int id) { }
}
```

#### Библиотека сервисов
```csharp
public class ProductService
{
    private ProductCatalog catalog;
    
    public ProductService(ProductCatalog catalog)
    {
        this.catalog = catalog;
    }
    
    public List<Product> SearchByCategory(string category) { }
    public List<Product> SearchByPriceRange(decimal min, decimal max) { }
}
```

#### Консольное приложение
```csharp
class Program
{
    static void Main()
    {
        var catalog = new ProductCatalog();
        var service = new ProductService(catalog);
        
        // Использование библиотек
        var products = service.SearchByCategory("Электроника");
        foreach (var product in products)
        {
            Console.WriteLine(product);
        }
    }
}
```

## Заключение

DLL-библиотеки являются основой модульной архитектуры в .NET. Они позволяют создавать переиспользуемые компоненты, разделять ответственность между слоями приложения и упрощать разработку сложных систем. Правильное использование библиотек значительно улучшает архитектуру приложений и упрощает их поддержку. 