# Лабораторная работа №15: Обработка исключительных ситуаций

## Цель работы
Сформировать умения разрабатывать, отлаживать и испытывать программы обработки исключительных ситуаций.

## Выполненные задания (3-й вариант)

### Задание 1: Создание пользовательского класса исключений и класса-генератора исключений
**Вариант 3: Проверка длины строки**

- Создан пользовательский класс исключения `StringLengthException` с дополнительными свойствами `RequiredLength` и `ActualLength`.
- Класс `StringValidator` содержит методы для валидации длины строки и генерации исключений.

### Задание 2: Обработка пользовательского исключения и логирование ошибки
**Вариант 3: Проверка длины строки**

- Класс `ExceptionHandler` обрабатывает исключения `StringLengthException`.
- Класс `ConsoleLogger` обеспечивает цветное логирование с временными метками для ошибок, успехов и информационных сообщений.

### Задание 3: Обработка нескольких исключений с бизнес-логикой
**Вариант 3: Удаление элемента массива по индексу**

- Класс `ArrayProcessor` содержит три метода с обработкой исключений:
  1. `SplitStrings` - разделение строк с проверкой на пустые массивы и длинные строки
  2. `FindMaxNumber` - поиск максимума с проверкой на пустые массивы
  3. `RemoveElementAt` - удаление элемента по индексу с проверкой границ массива

---

## Теоретические основы

### Исключения в C#

**Определение:** Исключения - это события, которые происходят во время выполнения программы и нарушают нормальный поток выполнения.

**Иерархия исключений:**
```
System.Object
└── System.Exception
    ├── System.SystemException
    │   ├── ArgumentException
    │   ├── IndexOutOfRangeException
    │   ├── NullReferenceException
    │   └── ...
    └── System.ApplicationException
```

### Пользовательские исключения

**Создание:**
```csharp
public class CustomException : Exception
{
    public CustomException(string message) : base(message) { }
    public CustomException(string message, Exception innerException) 
        : base(message, innerException) { }
}
```

**Особенности:**
- Наследуются от `Exception` или его производных
- Могут содержать дополнительные свойства
- Должны быть сериализуемыми
- Следуют соглашениям об именовании (суффикс "Exception")

### Обработка исключений

**Блоки try-catch:**
```csharp
try
{
    // Код, который может вызвать исключение
}
catch (SpecificException ex)
{
    // Обработка конкретного исключения
}
catch (Exception ex)
{
    // Обработка всех остальных исключений
}
finally
{
    // Код, выполняемый всегда
}
```

### Лучшие практики

**Создание исключений:**
1. Создавайте специфичные исключения для конкретных ошибок
2. Включайте контекстную информацию в сообщение
3. Используйте конструкторы с innerException для цепочки исключений
4. Делайте исключения сериализуемыми

**Обработка исключений:**
1. Обрабатывайте исключения на соответствующем уровне
2. Не подавляйте исключения без логирования
3. Используйте finally для освобождения ресурсов
4. Избегайте пустых catch-блоков

### Логирование исключений

**Принципы:**
- Логируйте все исключения
- Включайте контекстную информацию
- Используйте соответствующие уровни логирования
- Обеспечьте возможность настройки вывода

**Пример:**
```csharp
public class Logger
{
    public void LogError(string message, Exception ex = null)
    {
        var timestamp = DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss");
        Console.WriteLine($"[ОШИБКА] {timestamp}: {message}");
        if (ex != null)
            Console.WriteLine($"Детали: {ex}");
    }
}
```

### Типы исключений

**Системные исключения:**
- `ArgumentException` - некорректные аргументы
- `IndexOutOfRangeException` - выход за границы массива
- `NullReferenceException` - обращение к null
- `InvalidOperationException` - некорректная операция

**Пользовательские исключения:**
- Создаются для специфичных бизнес-ошибок
- Содержат дополнительную информацию
- Улучшают читаемость кода

### Обработка множественных исключений

**Подходы:**
1. **Последовательная обработка:** разные catch-блоки для разных типов
2. **Фильтрация:** использование when для условной обработки
3. **Агрегация:** использование AggregateException

### Отладка исключений

**Инструменты:**
- Точки останова в catch-блоках
- Логирование стека вызовов
- Анализ innerException
- Использование Debug.Assert

### Производительность

**Рекомендации:**
- Не используйте исключения для управления потоком выполнения
- Избегайте исключений в циклах
- Используйте TryParse вместо Parse
- Кэшируйте исключения для повторного использования

### Примеры использования

**Валидация данных:**
```csharp
public void ValidateAge(int age)
{
    if (age < 0 || age > 150)
        throw new ArgumentOutOfRangeException(nameof(age), "Возраст должен быть от 0 до 150");
}
```

**Работа с файлами:**
```csharp
public string ReadFile(string path)
{
    try
    {
        return File.ReadAllText(path);
    }
    catch (FileNotFoundException ex)
    {
        throw new CustomFileException($"Файл не найден: {path}", ex);
    }
}
```

---

**Лабораторная работа выполнена с акцентом на компактность, читаемость и демонстрацию обработки исключений в C#.** 